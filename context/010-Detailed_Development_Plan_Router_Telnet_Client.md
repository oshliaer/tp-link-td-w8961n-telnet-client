### Детализированный план реализации (30-минутные этапы)

**Фаза 1: Переход на Python 3**

*   **Этап 1.1: Создание резервной копии и подготовка.**
    *   **Действие:** Сделать копию файла `tp-w8961n-status.py` (например, `tp-w8961n-status.py.bak`).
    *   **Проверка:** Наличие файла `tp-w8961n-status.py.bak` в директории.
    *   **Время:** 15 минут.

*   **Этап 1.2: Конвертация `print` операторов.**
    *   **Действие:** В файле `tp-w8961n-status.py` заменить все `print` операторы на функции `print()`.
    *   **Проверка:** Запустить скрипт в Python 3. Должны исчезнуть ошибки синтаксиса, связанные с `print`.
    *   **Время:** 30 минут.

*   **Этап 1.3: Проверка базового выполнения в Python 3.**
    *   **Действие:** Запустить скрипт в Python 3.
    *   **Проверка:** Скрипт должен запуститься и попытаться подключиться к роутеру, возможно, с ошибками, но без синтаксических ошибок Python 3.
    *   **Время:** 15 минут.

*   **Этап 1.4: Адаптация `telnetlib` и `re` для Python 3.**
    *   **Действие:** Проверить, как `telnetlib.read_until()` и `re.search()` работают со строками и байтами в Python 3. Возможно, потребуется добавить `.decode('ascii')` или `.encode('ascii')` в соответствующих местах.
    *   **Проверка:** Скрипт должен успешно подключаться, отправлять команды и парсить ответы без ошибок кодировки.
    *   **Время:** 30 минут.

*   **Этап 1.5: Финальная проверка функциональности Python 3.**
    *   **Действие:** Запустить скрипт и убедиться, что он выполняет все свои исходные функции (получение статуса, скорости, качества) без ошибок в Python 3.
    *   **Проверка:** Вывод в консоль должен быть аналогичен выводу в Python 2.
    *   **Время:** 30 минут.

**Фаза 2: Расширение сбора данных**

*   **Этап 2.1: Анализ вывода для версии прошивки.**
    *   **Действие:** Вручную подключиться к роутеру по Telnet и выполнить команду для получения версии прошивки (например, `sys info` или `adsl info` - нужно найти подходящую). Записать полный вывод.
    *   **Проверка:** Наличие записанного вывода команды с версией прошивки.
    *   **Время:** 30 минут.

*   **Этап 2.2: Создание класса `FirmwareVersionCommand`.**
    *   **Действие:** Создать новый класс `FirmwareVersionCommand`, унаследованный от `Command`, с методом `get_cmd()` и `parse()` для извлечения `FwVer` и `HwVer`.
    *   **Проверка:** Класс `FirmwareVersionCommand` создан, методы реализованы.
    *   **Время:** 30 минут.

*   **Этап 2.3: Интеграция и тестирование `FirmwareVersionCommand`.**
    *   **Действие:** Добавить вызов `FirmwareVersionCommand` в основной цикл скрипта и вывести результат.
    *   **Проверка:** В консоли отображается корректная версия прошивки.
    *   **Время:** 30 минут.

*   **Этап 2.4: Анализ вывода для состояния линии (Showtime, Модуляция, Режим Annex).**
    *   **Действие:** Вручную выполнить команду Telnet для получения этих данных (возможно, `wan adsl status` или `adsl info`). Записать вывод.
    *   **Проверка:** Наличие записанного вывода.
    *   **Время:** 30 минут.

*   **Этап 2.5: Создание класса `LineInfoCommand`.**
    *   **Действие:** Создать класс `LineInfoCommand` с `get_cmd()` и `parse()` для извлечения `Showtime`, `Модуляция`, `Режим Annex`.
    *   **Проверка:** Класс `LineInfoCommand` создан, методы реализованы.
    *   **Время:** 30 минут.

*   **Этап 2.6: Интеграция и тестирование `LineInfoCommand`.**
    *   **Действие:** Добавить вызов `LineInfoCommand` в основной цикл и вывести результат.
    *   **Проверка:** В консоли отображаются корректные данные о состоянии линии.
    *   **Время:** 30 минут.

*   **Этап 2.7: Анализ вывода для трафика (Входящий/Исходящий).**
    *   **Действие:** Вручную выполнить команду Telnet для получения данных о трафике (например, `wan adsl stats` или `traffic display`). Записать вывод.
    *   **Проверка:** Наличие записанного вывода.
    *   **Время:** 30 минут.

*   **Этап 2.8: Создание класса `TrafficCommand`.**
    *   **Действие:** Создать класс `TrafficCommand` с `get_cmd()` и `parse()` для извлечения входящего и исходящего трафика.
    *   **Проверка:** Класс `TrafficCommand` создан, методы реализованы.
    *   **Время:** 30 минут.

*   **Этап 2.9: Интеграция и тестирование `TrafficCommand`.**
    *   **Действие:** Добавить вызов `TrafficCommand` в основной цикл и вывести результат.
    *   **Проверка:** В консоли отображаются корректные данные о трафике.
    *   **Время:** 30 минут.

*   **Этап 2.10: Анализ вывода для SNR, Затухания, Скорости, Максимальной скорости, Питания.**
    *   **Действие:** Вручную выполнить команды Telnet для получения этих данных (возможно, `wan adsl l n`, `wan adsl l f` и другие). Записать вывод.
    *   **Проверка:** Наличие записанного вывода.
    *   **Время:** 30 минут.

*   **Этап 2.11: Расширение `RateCommand` и `QualityCommand`.**
    *   **Действие:** Модифицировать существующие классы `RateCommand` и `QualityCommand` или создать новые, чтобы они извлекали все запрошенные метрики: `Отношение сигнал/шум`, `Затухание линии`, `Скорость передачи данных`, `Максимальная скорость`, `Питание`.
    *   **Проверка:** Модифицированные/новые классы реализованы.
    *   **Время:** 30 минут.

*   **Этап 2.12: Интеграция и тестирование расширенных команд.**
    *   **Действие:** Добавить вызовы расширенных команд в основной цикл и вывести результаты.
    *   **Проверка:** В консоли отображаются все корректные данные по SNR, затуханию, скоростям и питанию.
    *   **Время:** 30 минут.

*   **Этап 2.13: Анализ вывода для CRC.**
    *   **Действие:** Вручную выполнить команду Telnet для получения данных о CRC (возможно, `wan adsl stats`). Записать вывод.
    *   **Проверка:** Наличие записанного вывода.
    *   **Время:** 30 минут.

*   **Этап 2.14: Создание класса `CRCCommand`.**
    *   **Действие:** Создать класс `CRCCommand` с `get_cmd()` и `parse()` для извлечения значения CRC.
    *   **Проверка:** Класс `CRCCommand` создан, методы реализованы.
    *   **Время:** 30 минут.

*   **Этап 2.15: Интеграция и тестирование `CRCCommand`.**
    *   **Действие:** Добавить вызов `CRCCommand` в основной цикл и вывести результат.
    *   **Проверка:** В консоли отображается корректное значение CRC.
    *   **Время:** 30 минут.

*   **Этап 2.16: Общая проверка сбора данных.**
    *   **Действие:** Запустить скрипт и убедиться, что все новые и старые метрики корректно собираются и выводятся в консоль.
    *   **Проверка:** Все запрошенные метрики присутствуют в выводе и имеют ожидаемые значения.
    *   **Время:** 30 минут.

**Фаза 3: Улучшение архитектуры и конфигурируемости**

*   **Этап 3.1: Создание файла конфигурации.**
    *   **Действие:** Создать файл `config.py` (или `config.ini`/`config.json`) и добавить в него заглушки для `router_ip`, `username`, `password`, `polling_interval_seconds`.
    *   **Проверка:** Файл конфигурации создан с базовыми параметрами.
    *   **Время:** 30 минут.

*   **Этап 3.2: Вынесение параметров роутера в конфигурацию.**
    *   **Действие:** Модифицировать `TPW8961N` для чтения `host`, логина и пароля из `config.py`.
    *   **Проверка:** Скрипт запускается и использует параметры из `config.py`.
    *   **Время:** 30 минут.

*   **Этап 3.3: Вынесение интервала опроса в конфигурацию.**
    *   **Действие:** Модифицировать основной цикл для чтения `polling_interval_seconds` из `config.py`.
    *   **Проверка:** Изменение значения в `config.py` влияет на интервал между опросами.
    *   **Время:** 30 минут.

*   **Этап 3.4: Настройка базового логирования.**
    *   **Действие:** Инициализировать модуль `logging` в начале скрипта, настроить вывод в консоль.
    *   **Проверка:** Сообщения `logging.info()` и `logging.error()` выводятся в консоль.
    *   **Время:** 30 минут.

*   **Этап 3.5: Замена `print` ошибок на `logging.error`.**
    *   **Действие:** Заменить все `print` в блоках `except` на `logging.error()`.
    *   **Проверка:** При возникновении ошибки она записывается в лог.
    *   **Время:** 30 минут.

*   **Этап 3.6: Добавление специфичных обработчиков ошибок Telnet.**
    *   **Действие:** Добавить `try-except` блоки для `socket.error` (проблемы с сетью) и `EOFError` (неожиданное закрытие соединения) вокруг операций `telnetlib`.
    *   **Проверка:** При отключении роутера или обрыве соединения скрипт корректно обрабатывает ошибку и логирует её.
    *   **Время:** 30 минут.

**Фаза 4: Хранение и вывод данных**

*   **Этап 4.1: Выбор формата и создание класса `DataStorage`.**
    *   **Действие:** Принять решение о формате хранения (например, CSV). Создать пустой класс `DataStorage` с заглушкой для метода `save_data(data)`.
    *   **Проверка:** Класс `DataStorage` создан.
    *   **Время:** 30 минут.

*   **Этап 4.2: Реализация сохранения в CSV.**
    *   **Действие:** В классе `DataStorage` реализовать метод `save_data(data)`, который будет записывать словарь данных в CSV-файл (с заголовками, если файл новый).
    *   **Проверка:** После запуска скрипта создается CSV-файл с одной строкой данных.
    *   **Время:** 30 минут.

*   **Этап 4.3: Интеграция `DataStorage` в основной цикл.**
    *   **Действие:** В основном цикле скрипта собрать все полученные метрики в один словарь и передать его в `DataStorage.save_data()`.
    *   **Проверка:** После нескольких циклов в CSV-файле появляются новые строки с данными.
    *   **Время:** 30 минут.

*   **Этап 4.4: Рефакторинг сбора данных в единый объект.**
    *   **Действие:** Модифицировать основной цикл так, чтобы все результаты команд собирались в один структурированный объект (например, словарь), прежде чем передаваться в `DataStorage` и выводиться в консоль.
    *   **Проверка:** Все данные собраны в один словарь перед сохранением/выводом.
    *   **Время:** 30 минут.

*   **Этап 4.5: Форматированный вывод в консоль.**
    *   **Действие:** Реализовать функцию или метод, который принимает собранный словарь данных и выводит его в консоль в удобочитаемом, форматированном виде.
    *   **Проверка:** Консольный вывод стал более структурированным и понятным.
    *   **Время:** 30 минут.

